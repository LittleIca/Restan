<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Aplikasi Input Restan</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f8ff;
      padding: 30px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #2a9d8f;
    }

    .form-container {
      background: #ffffff;
      padding: 50px;
      border-radius: 12px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      background: #2a9d8f;
      color: white;
      font-weight: bold;
      margin-top: 20px;
      cursor: pointer;
    }

    button:hover {
      background: #21867a;
    }

    .preview {
      margin-top: 40px;
      background: #ffffff;
      padding: 20px;
      border-radius: 12px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
      cursor: pointer;
    }

    th {
      background-color: #2a9d8f;
      color: white;
    }

    tfoot td {
      background-color: #e0f7f1;
      font-weight: bold;
    }

    .action-btn {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      margin: 0 2px;
      cursor: pointer;
      display: none;
    }

    .edit-btn {
      background-color: #ffbb33;
      color: white;
    }

    .delete-btn {
      background-color: #ff4444;
      color: white;
    }

    .print-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .signature {
      text-align: right;
      margin-top: 30px;
      font-style: italic;
      font-size: 0.9em;
      color: #888;
    }

    @media print {
      .action-btn,
      .print-buttons,
      .form-container {
        display: none !important;
      }
    }
  </style>
</head>
<body>

  <h1>Input Data Restan</h1>

  <div class="form-container">
    <label for="tanggal">Tanggal:</label>
    <input type="date" id="tanggal">

    <label for="blok">Blok:</label>
    <select id="blok">
      <option value="">Pilih Blok</option>
    </select>

    <label for="restan">Restan (buah):</label>
    <input type="number" id="restan" placeholder="Masukkan angka restan">

    <button onclick="tambahData()">Tambah Data</button>
  </div>

  <div class="preview">
    <h2>Rekap Restan</h2>
    <div id="previewTable"></div>

    <div class="signature">By Petugas Supply Material</div>

    
  </div>
<div class="print-buttons">
      <button onclick="cetakPDF()">üìÑ Cetak ke PDF</button>
      <button onclick="cetakGambar()">üñºÔ∏è Cetak ke Gambar</button>
    </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    const blokSelect = document.getElementById("blok");
    for (let i = 13; i <= 45; i++) {
      const option = document.createElement("option");
      option.value = i;
      option.textContent = i;
      blokSelect.appendChild(option);
    }

    let data = {};
    let editIndex = null;
    let editTanggal = null;

    function tambahData() {
      const tanggal = document.getElementById("tanggal").value;
      const blok = document.getElementById("blok").value;
      const restan = parseInt(document.getElementById("restan").value);

      if (!tanggal || !blok || isNaN(restan)) {
        alert("Mohon lengkapi semua kolom!");
        return;
      }

      const total = restan * 500;

      if (editIndex !== null && editTanggal !== null) {
        data[editTanggal][editIndex] = { blok, restan, total };
        editIndex = null;
        editTanggal = null;
      } else {
        if (!data[tanggal]) {
          data[tanggal] = [];
        }
        data[tanggal].push({ blok, restan, total });
      }

      tampilkanPreview();
      bersihkanForm();
    }

    function tampilkanPreview() {
      const container = document.getElementById("previewTable");
      container.innerHTML = "";

      for (let tanggal in data) {
        let tableHTML = `
          <h3>Tanggal: ${tanggal}</h3>
          <table>
            <thead>
              <tr>
                <th>Blok</th>
                <th>Restan</th>
                <th>Total</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody>
        `;

        let jumlahTotal = 0;

        data[tanggal].forEach((row, index) => {
          jumlahTotal += row.total;
          const rowId = `row-${tanggal}-${index}`;
          tableHTML += `
            <tr id="${rowId}" onclick="tampilkanAksi('${tanggal}', ${index})">
              <td>${row.blok}</td>
              <td>${row.restan}</td>
              <td>${row.total.toLocaleString()}</td>
              <td>
                <button class="action-btn edit-btn" id="edit-${rowId}" onclick="event.stopPropagation(); editData('${tanggal}', ${index})">Edit</button>
                <button class="action-btn delete-btn" id="delete-${rowId}" onclick="event.stopPropagation(); hapusData('${tanggal}', ${index})">Hapus</button>
              </td>
            </tr>
          `;
        });

        tableHTML += `
            </tbody>
            <tfoot>
              <tr>
                <td colspan="3"><strong>Jumlah</strong></td>
                <td><strong>${jumlahTotal.toLocaleString()}</strong></td>
              </tr>
            </tfoot>
          </table>
        `;

        container.innerHTML += tableHTML;
      }
    }

    function tampilkanAksi(tanggal, index) {
      const rowId = `row-${tanggal}-${index}`;
      document.querySelectorAll(".action-btn").forEach(btn => btn.style.display = "none");
      document.getElementById(`edit-${rowId}`).style.display = "inline-block";
      document.getElementById(`delete-${rowId}`).style.display = "inline-block";
    }

    function editData(tanggal, index) {
      const item = data[tanggal][index];
      document.getElementById("tanggal").value = tanggal;
      document.getElementById("blok").value = item.blok;
      document.getElementById("restan").value = item.restan;
      editIndex = index;
      editTanggal = tanggal;
    }

    function hapusData(tanggal, index) {
      if (confirm("Yakin ingin menghapus data ini?")) {
        data[tanggal].splice(index, 1);
        if (data[tanggal].length === 0) {
          delete data[tanggal];
        }
        tampilkanPreview();
      }
    }

    function bersihkanForm() {
      document.getElementById("blok").value = "";
      document.getElementById("restan").value = "";
      editIndex = null;
      editTanggal = null;
    }

    async function cetakPDF() {
      const { jsPDF } = window.jspdf;
      const element = document.querySelector(".preview");

      const canvas = await html2canvas(element);
      const imgData = canvas.toDataURL("image/png");

      const pdf = new jsPDF("p", "mm", "a4");
      const pageWidth = pdf.internal.pageSize.getWidth();
      const imgWidth = pageWidth - 20;
      const imgHeight = (canvas.height * imgWidth) / canvas.width;

      pdf.addImage(imgData, "PNG", 10, 10, imgWidth, imgHeight);
      pdf.save("data-preview.pdf");
    }

    async function cetakGambar() {
      const element = document.querySelector(".preview");
      const canvas = await html2canvas(element);
      const link = document.createElement("a");
      link.href = canvas.toDataURL("image/png");
      link.download = "data-preview.png";
      link.click();
    }
  </script>

</body>
</html>